{% extends 'base.html' %}


{% block content %} 
<style>
    #dropzone {
        background: rgba(242, 242, 242, 0.4);
        border: 1px dashed rgba(97, 97, 97, 0.2);
        border-radius: 6px;
        position: absolute;
        height:150px; 
        width: 470px;
        align-items: left; 
    }
    #chooseFileFrontpage{
        display: block;
        visibility: hidden;
        width: 0;
        height: 0;
    }

    #chooseFileHeader{
        display: block;
        visibility: hidden;
        width: 0;
        height: 0;
    }

    #browse:hover {
        cursor: pointer;
    }
    
    #container{
        height: 500px;
        width:80%;
    }

    #leftcol {
        justify-content: left;
        width:47%;
        margin-top:20px;
        margin-left: 3%;
    }

    #rightcol{
        justify-content: left;
        width:47%;
        margin-top:20px;
        margin-right: 3%;
    }

    #bodyHeader{
        font-family: 'Poppins';
        font-style: normal;
        font-weight: 600;
        font-size: 18px;
        line-height: 14px;
        color: #314C74;
        white-space: nowrap;
        display:inline-block
    }

    .container .nav .nav-item .nav-link {
        color:#7788A3;
        background-color: #FFFFFF;
        border: 2px solid ;
        border-radius: 6px 6px 0px 0px;
        margin-right: 0.3rem;
    }

    .tab-content{
        background-color:#FFFFFF;
        mix-blend-mode: normal;
        border-radius: 0px 0px 15px 15px;
        max-width:80%;
        height:600px;
    }

    .progress-bar-styling{
        width: 70%;
        height: 1.5rem;
        margin-top: 30px;
        position:absolute;
        right:2%;
        top:13%;
        accent-color: rgb(131, 151, 182);
        opacity: 0.5;
    }

    .progress-bar-settings{
        width: 70%;
        height: 1.5rem;
        margin-top: 30px;
        position:absolute;
        right:2%;
        top:13%;
        accent-color: rgb(131, 151, 182);
        opacity: 0.5;
    }

    .progress-bar-overall {
        border: 1px dashed rgba(97, 97, 97, 0.2);
        border-radius: 6px;
        position: absolute;
        height:120px; 
        width: 470px;
        align-items: left; 
        box-sizing: border-box;
        background: #FFFFFF;
        border: 1px solid rgba(97, 97, 97, 0.1);
        box-shadow: 0px 3px 2px rgba(97, 97, 97, 0.1);
        border-radius: 6px;
        margin-top:170px;
        visibility: hidden;
    }

    .titles{
        text-align: left;
        color: #717171;
    }

    .form-select{
        position:absolute;
        width:35.5%;
        font-family: 'Poppins';
        font-style: normal;
        font-weight: 500;
        font-size: 12px;
        line-height: 14px;
    }

    .btn-close{
        font-size:10px;
        color: #B8B8B8;
        position:absolute;
        top:5%;
        right:2%;
    }

    .percentage-loaded{
        position:absolute;
        bottom:28%;
        right:4%;
        font-family: 'Poppins';
        font-style: normal;
        font-weight: 500;
        font-size: 12px;
        color: #717171;
        opacity: 0.5;
    }

    .file-name{
        color: #717171;
        font-family: 'Poppins';
        font-style: normal;
        font-weight: 500;
        font-size: 13px;
        position:absolute; 
        left:29%;
        top:28%;
    }
    .uploaded-image{
        position:absolute; 
        left:5%;
        top:13%;
    }
    .byte-status{
        font-family: 'Poppins';
        font-style: normal;
        font-weight: 500;
        font-size: 12px;
        color: #717171;
        opacity: 0.5;
        position:absolute;
        bottom:28%;
        left:28%;
    }

</style>
<div id="bodyHeader">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-folder-plus" viewBox="0 0 20 20"  style="position: absolute;
        left: 15.67%;
        right: 78.33%;
        top: 17.53%;
        bottom: 82.13%;">
                <path d="m.5 3 .04.87a1.99 1.99 0 0 0-.342 1.311l.637 7A2 2 0 0 0 2.826 14H9v-1H2.826a1 1 0 0 1-.995-.91l-.637-7A1 1 0 0 1 2.19 4h11.62a1 1 0 0 1 .996 1.09L14.54 8h1.005l.256-2.819A2 2 0 0 0 13.81 3H9.828a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 6.172 1H2.5a2 2 0 0 0-2 2zm5.672-1a1 1 0 0 1 .707.293L7.586 3H2.19c-.24 0-.47.042-.683.12L1.5 2.98a1 1 0 0 1 1-.98h3.672z"/>
                <path d="M13.5 10a.5.5 0 0 1 .5.5V12h1.5a.5.5 0 1 1 0 1H14v1.5a.5.5 0 1 1-1 0V13h-1.5a.5.5 0 0 1 0-1H13v-1.5a.5.5 0 0 1 .5-.5z"/>
            </svg>
        <p style="position: absolute;
        left: 17.67%;
        right: 78.33%;
        top: 17.53%;
        bottom: 82.13%;"> Corporate Health Report </p> 
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-chevron-right" viewBox="0 0 20 20" style="position:absolute;
        left: 30.67%;
        right: 78.33%;
        top: 17.53%;
        bottom: 82.13%;">
            <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
        </svg>
        <p style="position: absolute;
        left: 32.2%;
        right: 78.33%;
        top: 17.53%;
        bottom: 82.13%;">Setting</p>
</div>

<div id="overall-container" class = "container mt-2">
    <ul class = "nav nav-tabs" style="border-bottom: none;">
        <li class="nav-item"><a class = "nav-link active" data-bs-toggle="tab" href="#branding"> Branding </a></li>
        <li class="nav-item"><a class = "nav-link " data-bs-toggle="tab" href="#recTemplate"> Rec Template </a></li>
    </ul>
    <div class="tab-content">
        <div class = "tab-pane active" id="branding">
                <div class="row">
                    <div id="leftcol"> 
                        <h6 class="titles"> Organisation Name </h6>
                        <p class="titles"> Healthway Medical </p>
                        <div>  
                            <h6 class="titles" style="margin-top:75px;"> Upload Frontpage Logo </h6>
                            <form id="dropzone" ondrop="dropHandler(event,'progress-bar','frontpage-name');" ondragover="dragOverHandler(event);">
                                <div style="margin-top: 37.5px;color:#B7B7B7">
                                    <p>Drag and drop or <input id="chooseFileFrontpage" type="file" onchange="handleUpload('progress-bar','chooseFileFrontpage','frontpage-name','header-image-frontpage','currByteFrontpage','totalByteFrontpage','frontpage-logo-box')"/>
                                        <u id="browse" style="color:#8397B6" onclick="clickBrowseFrontpage()">browse</u></p>
                                    <p>File should be in png or svg format</p>
                                </div>
                            </form>
                            <div class="progress-bar-overall" id="frontpage-logo-box">
                                <img class="uploaded-image" id="header-image-frontpage" height="90" width="90">
                                <p class="file-name" id="frontpage-name"><p></p>
                                <button type="button" class="btn-close" aria-label="Close" onclick="toggleLogoBox('frontpage-logo-box','header-image-frontpage','progress-bar','currByteFrontpage','totalByteFrontpage','frontpage-name')"></button>
                                <label for="progress-bar" class="percentage-loaded">0%</label>
                                <progress id="progress-bar" value="0" max="100" class="progress-bar-settings"></progress>
                                <div class="byte-status">
                                    <span id="currByteFrontpage"></span>
                                    <span>of</span>
                                    <span id="totalByteFrontpage"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="rightcol"> 
                        <h6 class="titles"> Corporate Report Font </h6> 
                        <select id="fontSelector" class="form-select" aria-label="Default select example" onclick="displayFonts()"  onmousedown="if(this.options.length>8){this.size=8}"
                            onchange='this.blur()' onblur="this.removeAttribute('size')">
                        </select>
                        <div>
                            <h6 class="titles" style="margin-top:107px;"> Upload Header Logo </h6>
                            <form id="dropzone" ondrop="dropHandler(event,'header-progress-bar','header-name');" ondragover="dragOverHandler(event);">
                                <div style="margin-top: 37.5px;color:#B7B7B7">
                                    <p>Drag and drop or <input id="chooseFileHeader" type="file" onchange="handleUpload('header-progress-bar', 'chooseFileHeader','header-name','header-image-logo','currByteLogo','totalByteLogo','header-logo-box')"/>
                                        <u id="browse" style="color:#8397B6" onclick="clickBrowseHeader()">browse</u></p>
                                    <p>File should be in png or svg format</p>
                                </div>
                            </form>
                            <div class="progress-bar-overall" id="header-logo-box">
                                <img class="uploaded-image" id="header-image-logo" height="90" width="90">
                                <p class="file-name" id="header-name"><p>
                                <button type="button" class="btn-close" aria-label="Close" onclick="toggleLogoBox('header-logo-box','header-image-logo','header-progress-bar','currByteLogo','totalByteLogo','header-name')"></button>
                                <label for="header-progress-bar" class="percentage-loaded">0%</label>
                                <progress id="header-progress-bar" value="0" max="100" class="progress-bar-settings"></progress>
                                <div class="byte-status">
                                    <span id="currByteLogo"></span>
                                    <span>of</span>
                                    <span id="totalByteLogo"></span>
                                </div>
                                <div class="after-load-complete">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                                        <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                        <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                                      </svg>
                                </div>
                            </div>
                        </div>
                    </div>
            </div>
        </div>
        <div class = "tab-pane" id="recTemplate" style="width:80%">
            <div class="outer-row border g-0 rounded shadow-sm">
                <div class="row">
                    <div id="leftcol"> 
                        <h6 style="border-bottom: 1px solid #7788A3;"> Panel </h6>
                        <p> hello </p>
                        <p> hello </p>
                        <p> hello </p>
                    </div>
                    <div id="rightcol"> 
                        <h6 style="border-bottom: 1px solid #7788A3;"> Key Recommendations    Edit all</h6> 
                        <p> hello </p>
                        <p> hello </p>
                        <p> hello </p>
                        <p> hello </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
<script>
   
    function toggleLogoBox(logoBox,imageID,progressBarID,totalByteID,currByteID,filenameID){
        resetLogoBox(imageID,progressBarID,totalByteID,currByteID,filenameID);
        const ele = document.getElementById(logoBox);
        ele.style.visibility = 'hidden';
    }
    //reset values in logoBox after user clicks 'x'
    function resetLogoBox(imageID,progressBarID,totalByteID,currByteID,filenameID){
        console.log("Reset logo box")
        //reset image 
        const img = document.getElementById(imageID);
        img.src=null;
        //reset progress bar
        const progressBar = document.getElementById(progressBarID);
        progressBar.setAttribute('value', 0);
        progressBar.previousElementSibling.textContent = '0%';
        //reset bytes (total and curr)
        const totalByte = document.getElementById(totalByteID);
        totalByte.textContent='0 kb';
        const currByte = document.getElementById(currByteID);
        currByte.textContent='0 kb';
        //reset filename
        const filename = document.getElementById(filenameID);
        filename.textContent='';
    }

    function clickBrowseFrontpage(){
        //const choosefile = new Event('change');
        //const element = document.getElementById('chooseFileHeader');
        //const element = document.getElementById('chooseFileFrontpage');
        $('#chooseFileFrontpage').click();
        //element.dispatchEvent(choosefile);
    }
    
    function clickBrowseHeader(){
        //const choosefile = new Event('change');
        //const element = document.getElementById('chooseFileHeader');
        $('#chooseFileHeader').click();
        //element.dispatchEvent(choosefile);
    }

    function handleUpload(progressBar, chooseFile, imgNameUploadLocation, image_ID_name, currByteID, totalByteID, displayBlock){
        //make block visible 
        const ele = document.getElementById(displayBlock);
        ele.style.visibility = 'visible';
       // document.getElementById('header-logo-box').style.visibility = 'visible';
        const bar = document.getElementById(progressBar);
        const fileInput = document.getElementById(chooseFile);
        const img = fileInput.files[0];

        if(img.type.match('^image/')){
            const filename = img.name
            const filesize = img.size
            if(filesize <= 200000){//less than 200kb
                console.log(filename);
                //create form data
                var formdata = new FormData();
                formdata.append("image", img);
                //set image 
                const imagePreview = document.getElementById(image_ID_name);
                imagePreview.src = URL.createObjectURL(img);
                //set name of image uploaded
                const nameLocation = document.getElementById(imgNameUploadLocation);
                nameLocation.textContent=filename;
                //get byte references
                currByte = document.getElementById(currByteID);
                totalByte = document.getElementById(totalByteID);
                const config = {
                        onUploadProgress: function(progressEvent) {
                            
                            totalByte.textContent= progressEvent.total/1000 + ' kb';
                            currByte.textContent=progressEvent.loaded/1000 + ' kb';

                            const percentCompleted = Math.round((progressEvent.loaded / progressEvent.total)*100);
                            bar.setAttribute('value', percentCompleted);
                            bar.previousElementSibling.textContent = `${percentCompleted}%`
                            if (percentCompleted === 100) {
                                bar.previousElementSibling.textContent = `Upload complete!`
                            }
                        }
                    }
                axios.post('https://httpbin.org/post', formdata, config)
                    .then(res => console.log(res))
                    .catch(err => console.log(err));
            }else{
                alert("File size = " + filesize + ", please upload an image less than 200kb");
            }
        }else{
            alert("Please upload an image");
        }
    }

    function displayFonts(){
        //my google key which needs to be replaced
        axios.get("https://www.googleapis.com/webfonts/v1/webfonts?key=AIzaSyDgrWWpEL45XX_gqeVu0lw5P_X_JS63JR8").then((response) => {
            const items = response.data.items;
            var dropdown = document.getElementById("fontSelector");
            for(index in items){
                let option = document.createElement("option");
                option.text = items[index]['family'];
                option.value = items[index]['family'];
                dropdown.appendChild(option);
            }
        })
            .catch((error) =>console.error(error));
        };

        function dropHandler(ev,progressBar, ele_ID_name) {
            console.log('File(s) dropped');

            // Prevent default behavior (Prevent file from being opened)
            ev.preventDefault();
            console.log('dragstart: target.id = ${ev.target.id}');
            if (ev.dataTransfer.items) {
                // Use DataTransferItemList interface to access the file(s)
                [...ev.dataTransfer.items].forEach((item, i) => {
                // If dropped items aren't files, reject them
                if (item.kind === 'file') {
                    // Match only images eg png 
                    if(item.type.match('^image/')){
                        //get the file 
                        const file = item.getAsFile();
                        const filesize = file.size;
                        if(filesize <= 200000){
                            // log name 
                            console.log(`… file[${i}].name = ${file.name}`);
                            var formdata = new FormData();
                            formdata.append("image", file);
                        
                            const bar = document.getElementById(progressBar);
                            const ele_name = document.getElementById(ele_ID_name);
                            ele_name.textContent=file.name
                            
                            const config = {
                                    onUploadProgress: function(progressEvent) {
                                        const percentCompleted = Math.round((progressEvent.loaded / progressEvent.total)*100);
                                        bar.setAttribute('value', percentCompleted);
                                        bar.previousElementSibling.textContent = `${percentCompleted}%`
                                        if (percentCompleted === 100) {
                                            bar.previousElementSibling.textContent = `Upload complete!`
                                        }
                                    }
                                }
                                axios.post('https://httpbin.org/post', formdata, config)
                                    .then(res => console.log(res))
                                    .catch(err => console.log(err))
                        }else{
                            alert("File size = " + filesize + ", please upload an image less than 200kb");
                        }
                    }
                    else{
                        alert("Please upload an image");
                    }
                }else{
                    alert("Please upload files only");
                }
                });
            } else {
                // Use DataTransfer interface to access the file(s)
                [...ev.dataTransfer.files].forEach((file, i) => {
                console.log(`… file[${i}].name = ${file.name}`);
                });
            }
        }

        function dragOverHandler(ev) {
            console.log('File(s) in drop zone');

            // Prevent default behavior (Prevent file from being opened)
            ev.preventDefault();
            }
            
</script>
{% endblock %} 

{% block footer %} 
<style>

</style>
<div class = "footer"> 
    <p> Please <u><b><a href="https://wa.me/6593360639">contact MeshBio</a></b></u> for more customization </p>
    <button type="button" class="btn btn-primary" >Save & Update</button>
</div>
{% endblock %} 
